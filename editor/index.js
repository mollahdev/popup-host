(()=>{"use strict";class e{config={};constructor(){const e=this;this.setWidgetAttribute&&(e.config.widgetAttribute=this.setWidgetAttribute()),this.render&&(e.config.widgetAttribute.render=this.render.bind(e.config)),this.registerControls.apply({addControl:function(t,n){n.isLabelInline=n.isLabelInline||!1,e.config[t]=n}})}static select(e,t){return`<select value="${e.default}" data-key=${t} type="select" class="popup-control--trigger">\n                ${Object.keys(e.options).map((t=>`<option value="${t}">${e.options[t]}</option>`)).join("")}\n            </select>\n            `}static text(e,t){return`<input \n                value="${e.default}" \n                data-key=${t} \n                type="text" \n                class="popup-control--trigger"\n            />`}static color(e,t){return`<input \n                value="${e.default}" \n                data-key=${t} \n                type="color" \n                class="popup-control--trigger"\n            />`}static slider(e,t){return`<div class="slider-control">\n                <input\n                    class="popup-control--trigger"\n                    data-key=${t}\n                    type="range"\n                    min="0"  \n                    max=${e.max}  \n                    step=${e.step} \n                    value=${e.default}               \n                >\n                <span class="value">${e.default}px</span>\n            </div>\n            `}}let t={global:{}};const n={get:()=>t,set(e){t=e},add(e,n){t[e]=n},remove(e){delete t[e]}},s={text_widget:new class extends e{constructor(){return super(),this.config}setWidgetAttribute(){return{id:"text_widget",icon:"title",name:"Text Widget"}}registerControls(){this.addControl("text_content",{label:"Text Color",type:"text",default:"No credit card required. No Surprises ",selector:function(e,t){const n=jQuery(e);n.length&&n.find("span").text(t)}}),this.addControl("text_font_weight",{label:"Font Weight",type:"select",default:400,options:{400:"Regular",700:"Medium",900:"Bold"},selector:function(e,t){return`${e} span {\n                    font-weight: ${t};\n                }`}}),this.addControl("text_color",{label:"Text Color",type:"color",default:"#ffffff",isLabelInline:!0,selector:function(e,t){return`${e} span {\n                    color: ${t};\n                }`}}),this.addControl("text_font_size",{label:"Text Font Size",type:"slider",default:18,max:100,step:1,selector:function(e,t){return`${e} span {\n                    font-size: ${t}px;\n                }`}}),this.addControl("text_padding_x",{label:"Padding X",type:"slider",default:20,max:600,step:1,selector:function(e,t){return`${e} span {\n                    padding-left: ${t}px;\n                    padding-right: ${t}px;\n                }`}})}render(e){return`\n            <div class="popup-widget-element apb-${e}" data-uid="${e}" id="text_widget" data-type="widget">\n                <i class="remove-btn">x</i>\n                <div>\n                    <span>${this.text_content.default}</span>\n                </div>\n            </div>\n        `}}},i=new class{rule={};constructor(e){this.styleSheetId=e,this.fetchStylesheet()}seperateStyle(e){return{selector:e.split("{")[0].trim().replace(/\s{2,}/g," "),style:e.split("{")[1].trim().replace(/[&\/\\,$~.?<>{}]/g,"").replace(/\s{2,}/g," ")}}getCSS(){return new Promise(((e,t)=>{let n="";for(let e in this.rule)n+=`${e} {${this.rule[e].style}}`;document.getElementById(this.styleSheetId).innerText=n,this.rule={},this.fetchStylesheet(),e(n)}))}delete(e){for(let t of e)t=t.trim(),delete this.rule[t]}insert(e,t){if(e=e.trim(),this.rule[e]){const n=this.rule[e].index,s=this.sheet.rules.item(n).style;t.split(";").map((t=>{let n=t.split(":")[0],i=t.split(":")[1];if(n&&i){const t=i.includes("important")?"important":"";"important"===t&&(i=i.split("!")[0]),s.setProperty(n,i.trim(),t),this.rule[e].style=s.cssText}}))}else this.rule[e]={index:this.length,style:t},this.sheet.insertRule(`${e} {${t}}`,this.length),this.length=this.sheet.rules.length}cssDeclaration(e,t){return e.split(t).pop().replace(/[&\/\\,$~.?<>{}]/g,"").trim()}mergeRule(e,t,n){const s=this.rule[t].style,i=e.rules.item(n);let r=this.cssDeclaration(i.cssText,t);this.rule[t].style=r+s}fetchStylesheet(){const e=document.getElementById(this.styleSheetId).sheet,t=e.rules,n=Object.keys(t).reverse();for(let s of n){const n=t[s];if("object"==typeof n){const t=n.selectorText;Reflect.has(this.rule,t)?(this.rule[t].index=s,this.mergeRule(e,t,s),e.deleteRule(s)):this.rule[t]={index:s,style:this.cssDeclaration(n.cssText,t)}}}let s=0;for(let t in this.rule){this.rule[t].index=s;const n=this.rule[t].style;e.deleteRule(s),e.insertRule(`${t} {${n}}`,s),s++}this.sheet=e,this.length=e.rules.length}}("builder-css");class r extends e{constructor(){return super(),this.config}setWidgetAttribute(){return{id:"global",icon:"title",name:"Popup Settings"}}registerControls(){this.addControl("global_popup_bg",{label:"Popup Background Color",type:"color",default:"#e07a5f",isLabelInline:!0,selector:function(e,t){return`${e} .apb-wrapper {\n                    background-color: ${t};\n                }`}}),this.addControl("global_popup_radius",{label:"Popup Radius",type:"slider",default:500,max:500,step:10,selector:function(e,t){return`${e} .apb-wrapper {\n                    border-radius: ${t}px;\n                }`}}),this.addControl("global_popup_width",{label:"Popup Width",type:"slider",default:600,max:1e3,step:10,selector:function(e,t){return`${e} .apb-wrapper{\n                    width: ${t}px;\n                }`}}),this.addControl("global_popup_height",{label:"Popup Height",type:"slider",default:600,max:1e3,step:10,selector:function(e,t){return`${e} .apb-wrapper{\n                    height: ${t}px;\n                }`}})}}new class extends class{sidebarSettings={wheelSpeed:2,wheelPropagation:!0,minScrollbarLength:20};sidebarInit(){const e=new PerfectScrollbar(".aside__container",this.sidebarSettings);this.sidebarSettings.ps=e}createControlMarkup(t,s){const r=n.get()[s],l=".apb-"+s,o=Object.keys(t).map((n=>{const s=t[n],o=e[s.type];if(!o)return"";Reflect.has(r,n)?s.default=r[n]:r[n]=s.default;const a=s.selector(l,r[n]);if(a){const{selector:e,style:t}=i.seperateStyle(a);i.insert(e,t)}return`\n                <div class="control-item" data-inline="${s.isLabelInline}">\n                    <label> ${s.label} </label>\n                    <div class="control-item--field field-type-${s.type}">\n                        ${o(s,n)}\n                    </div>\n                </div>\n            `}));jQuery(".aside__container").html(`\n            <div class="control-container">\n                ${o.join("")}\n            </div>\n        `),jQuery(".popup-control--trigger").on("input",(function(e){e.preventDefault(),e.stopPropagation();const n=this.value,s=this.dataset.key;r[s]=n;const o=t[s].selector(l,r[s]);if(o){const{selector:e,style:t}=i.seperateStyle(o);i.insert(e,t)}"range"===this.type&&(this.nextElementSibling.innerText=n+"px")}))}createWidgetMarkup(){const e=Object.keys(s).map((e=>{const{widgetAttribute:t}=s[e];return`\n            <div class="popup-element" id="${t.id}">\n                <div class="popup-widget" draggable="true" data-type="${e}">\n                    <span class="material-icons-outlined">${t.icon}</span>\n                    <label>${t.name}</label>\n                </div>\n            </div>`}));jQuery(".aside__container").html(`\n            <div class="widget-container">\n                ${e.join("")}\n            </div>\n        `)}}{constructor(){super(),window.addEventListener("DOMContentLoaded",this.loadSavedMarkup.bind(this))}createControls(e,t){"popup-settings"===e?this.createControlMarkup(this.globalControls,"global"):this.createControlMarkup(s[e],t)}createWidget(){this.createWidgetMarkup()}onSaveChanges(){const e=jQuery(".save-changes-btn");e.on("click",(function(){e.addClass("is-loading");const t=jQuery(".alpha-popup-builder").parent().html();i.getCSS().then((s=>{jQuery.ajax({type:"POST",data:{action:"save",css:JSON.stringify(s),html:JSON.stringify(t),storage:JSON.stringify(n.get())},url:"http://localhost/popup-host/storage/index.php",success:function(){setTimeout((()=>{e.removeClass("is-loading")}),1e3)}})}))}))}uid(){let e=n.get();return new Promise(((t,n)=>{!function n(){let s=Math.floor(1e4*Math.random()+1);Reflect.has(e,s)?n():t(s)}()}))}onDropWidget(e){this.uid().then((t=>{const{name:s,id:r,render:l}=e.widgetAttribute;n.add(t,{});const o=n.get()[t];if("function"==typeof l){const n=l(t);jQuery(".alpha-popup-builder .apb-wrapper").append(n),jQuery(".popup-widget-element").draggable({containment:"parent"}),jQuery(".panel--info").text(s),Object.entries(e).map((([e,n])=>{if("widgetAttribute"!==e&&n.selector){o[e]=n.default;const s=n.selector(".apb-"+t,o[e]);if(s){const{selector:e,style:t}=i.seperateStyle(s);i.insert(e,t)}}}))}}))}dropWidget(e){jQuery(".popup-widget").draggable({helper:"clone"}),jQuery(document).find(".alpha-popup-builder").droppable({accept:".popup-widget",drop:function(t,n){const i=n.draggable.data("type");e.onDropWidget(s[i])}})}removeWidget(){jQuery(document).on("click",".remove-btn",(function(e){e.preventDefault(),e.stopPropagation();const t=jQuery(this).parent(),r=t.data("uid"),l=t.attr("id"),o=s[l],a=new Set;n.remove(r),Object.entries(o).map((([e,t])=>{if("widgetAttribute"!==e&&t.selector){const e=t.selector(".apb-"+r,"");e&&a.add(i.seperateStyle(e).selector)}})),i.delete(Array.from(a)),t.remove()}))}loadSavedMarkup(){const e=this;fetch("http://localhost/popup-host/storage/index.php?all").then((e=>e.json())).then((t=>{const{html:r,storage:l}=t.body;l&&n.set(JSON.parse(l)),r&&(jQuery(".alpha-popup-builder").parent().html(JSON.parse(r)),jQuery(".popup-widget-element").each(((e,t)=>{const r=t.dataset.uid,l=s[t.id],o=n.get()[r];Object.entries(l).map((([e,t])=>{if("widgetAttribute"!==e&&t.selector){Reflect.has(o,e)||(o[e]=t.default);const n=t.selector(".apb-"+r,o[e]);if(n){const{selector:e,style:t}=i.seperateStyle(n);i.insert(e,t)}}}))})),e.dropWidget(e),jQuery(".popup-widget-element").draggable({containment:"parent"})),e.init.call(e)}))}init(){const e=this;e.globalControls=new r,e.sidebarInit(),e.createControls("popup-settings"),e.createWidget(),e.onSaveChanges(),e.dropWidget(e),e.removeWidget(e),jQuery(document).on("click",".aside-btn, .popup-widget-element",(function(t){t.preventDefault(),t.stopPropagation();const n=this.dataset.type;switch(["popup-settings","widget-settings"].includes(n)&&(jQuery(".aside-btn").removeClass("active"),this.classList.add("active")),n){case"popup-settings":e.createControls.call(e,n),jQuery(".panel--info").text("Popup Settings");break;case"widget-settings":jQuery(".panel--info").text("Widgets List"),e.createWidget.call(e,n);break;case"widget":jQuery(".aside-btn").removeClass("active"),e.createControls.call(e,this.id,this.dataset.uid)}e.sidebarSettings.ps.update(),e.dropWidget(e),e.removeWidget(e)}))}}})();
//# sourceMappingURL=index.js.map